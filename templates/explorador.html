<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>AZTLAN COMMAND OS v6.0 - FTC SCOUT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        /* =================== ESTILOS CORE (EL DISE√ëO QUE TE GUSTA) =================== */
        :root { 
            --bg-deep: #020204; 
            --neon-blue: #00f3ff; 
            --neon-gold: #ffd700; 
            --neon-red: #ff3333; 
            --neon-green: #0aff0a; 
            --neon-pink: #ff00ff; 
            --panel-bg: rgba(8, 12, 20, 0.98); 
            --font-title: 'Orbitron', sans-serif; 
            --font-body: 'Rajdhani', sans-serif; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-deep); color: #e0e0e0; font-family: var(--font-body); overflow: hidden; height: 100vh; }
        
        /* PANTALLA DE CARGA */
        #boot-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1s ease-out; }
        .aztec-loader { position: relative; width: 150px; height: 150px; display: flex; justify-content: center; align-items: center; }
        .aztec-ring-outer { position: absolute; width: 100%; height: 100%; border: 2px dashed var(--neon-gold); border-radius: 50%; animation: spinReverse 10s linear infinite; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        .aztec-core { width: 20px; height: 20px; background: var(--neon-gold); transform: rotate(45deg); box-shadow: 0 0 30px var(--neon-gold); animation: pulseCore 1s infinite alternate; }
        .boot-text { margin-top: 40px; font-family: var(--font-title); color: var(--neon-blue); letter-spacing: 4px; font-size: 14px; text-align: center; animation: textFlicker 2s infinite; }
        @keyframes spinReverse { 0% { transform: rotate(360deg); } 100% { transform: rotate(0deg); } }
        @keyframes pulseCore { 0% { transform: rotate(45deg) scale(0.8); opacity: 0.5; } 100% { transform: rotate(45deg) scale(1.2); opacity: 1; } }
        @keyframes textFlicker { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        /* FONDO Y SCANLINES */
        #galaxy-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .scanline { width: 100%; height: 100%; z-index: 90; position: fixed; pointer-events: none; opacity: 0.05; background: linear-gradient(to bottom, transparent 50%, rgba(0, 243, 255, 0.1) 51%); background-size: 100% 4px; }
        
        /* CABECERA */
        header { position: absolute; top: 0; left: 0; width: 100%; height: 60px; background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--neon-blue); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; z-index: 100; backdrop-filter: blur(10px); }
        .brand { font-family: var(--font-title); font-size: 18px; font-weight: 700; color: var(--neon-gold); letter-spacing: 2px; }
        .level-badge { border: 1px solid var(--neon-blue); padding: 5px 10px; border-radius: 5px; font-size: 12px; color: var(--neon-blue); font-family: monospace; font-weight: bold; }
        .lang-toggle { cursor: pointer; border: 1px solid var(--neon-green); color: var(--neon-green); background: transparent; padding: 5px 10px; font-family: var(--font-title); font-size: 12px; margin-right: 15px; }
        
        /* DOCK */
        .dock { position: absolute; top: 60px; left: 0; bottom: 0; width: 70px; background: rgba(0,0,0,0.6); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; z-index: 90; }
        .dock-btn { width: 50px; height: 50px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); color: #888; display: flex; justify-content: center; align-items: center; font-size: 20px; cursor: pointer; transition: 0.3s; position: relative; }
        .dock-btn:hover { border-color: var(--neon-blue); color: var(--neon-blue); box-shadow: 0 0 20px rgba(0, 243, 255, 0.3); transform: scale(1.1); }
        .tooltip { position: absolute; left: 60px; background: var(--neon-blue); color: #000; padding: 2px 6px; font-size: 10px; font-weight: bold; border-radius: 4px; display: none; white-space: nowrap; font-family: var(--font-title); z-index: 200; pointer-events: none;}
        .dock-btn:hover .tooltip { display: block; }
        
        /* VENTANAS */
        .window { position: absolute; background: var(--panel-bg); border: 1px solid var(--neon-blue); border-radius: 10px; box-shadow: 0 0 40px rgba(0,0,0,0.9); backdrop-filter: blur(15px); display: none; flex-direction: column; overflow: hidden; animation: openWin 0.3s ease-out; min-width: 300px; }
        @keyframes openWin { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .win-header { height: 40px; background: rgba(0, 243, 255, 0.1); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; cursor: grab; }
        .win-title { font-family: var(--font-title); font-size: 12px; color: var(--neon-blue); letter-spacing: 1px; }
        .win-close { background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; }
        .win-body { flex: 1; overflow-y: auto; padding: 20px; color: #ddd; font-size: 14px; line-height: 1.6; }
        
        /* ESTILOS DE TABLA Y SCOUTING */
        #win-ftc-scout table { width: 100%; border-collapse: collapse; margin-top: 10px; background-color: rgba(0,0,0,0.3); font-size: 13px; }
        #win-ftc-scout th, #win-ftc-scout td { padding: 8px 10px; text-align: left; border: 1px solid rgba(255,255,255,0.1); }
        #win-ftc-scout th { background-color: rgba(0,243,255,0.2); color: var(--neon-blue); font-family: var(--font-title); font-weight: 500; }
        .pase-si { background-color: rgba(0, 255, 0, 0.2); color: var(--neon-green); font-weight: bold; } /* Verde para clasificado */
        .pase-no { background-color: rgba(255, 51, 51, 0.2); color: var(--neon-red); font-weight: bold; } /* Rojo/Rosa para no clasificado */
        .detalle-ficha { border-left: 5px solid var(--neon-pink); padding: 15px; margin-top: 20px; background-color: rgba(0,0,0,0.5); display: none; }
        .detalle-ficha h3 { color: var(--neon-pink); border-bottom: 1px solid rgba(255,0,255,0.3); padding-bottom: 5px; }
        .rp-destacado { font-size: 1.1em; color: var(--neon-gold); font-weight: bold; }
        
        /* INPUTS Y BOTONES */
        .input-label { display: block; color: var(--neon-gold); font-family: var(--font-title); font-size: 11px; margin-bottom: 5px; letter-spacing: 1px; text-transform: uppercase; text-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
        .input-tech { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 14px; transition: 0.3s; }
        .input-tech:focus { border-color: var(--neon-blue); box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); outline: none; }
        .toggle-btn { background:var(--neon-pink); color: #000; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 12px; font-family: var(--font-title); }
        .game-btn { padding: 10px 20px; background: var(--neon-red); color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: var(--font-title); font-size: 16px; margin-top: 10px; }

        /* Resto de estilos no modificados */
        .msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 8px; max-width: 85%; }
        /* ... otros estilos ... */
        
        @media (max-width: 768px) { 
            /* ... media queries ... */
        }
    </style>
</head>
<body>

<div id="boot-screen">    <div class="aztec-loader"><div class="aztec-ring-outer"></div><div class="aztec-core"></div></div>    <div class="boot-text" id="boot-text">SISTEMA INICIANDO...</div></div>
<canvas id="galaxy-canvas"></canvas><div class="scanline"></div>
<header>    <div class="brand"><i class="fas fa-sun"></i> <span id="txt-title">PROYECTO AZTL√ÅN</span></div>    <div style="display:flex; align-items:center;">        <button class="lang-toggle" onclick="toggleLang()">ES / EN</button>        <div class="level-badge" id="user-rank">CAPIT√ÅN (NVL 1)</div>    </div></header>
<div class="dock">    
    <div class="dock-btn" onclick="openWindow('win-nasa')"><i class="fas fa-eye"></i><div class="tooltip">NASA EYES</div></div>    
    <div class="dock-btn" onclick="openWindow('win-analysis')"><i class="fas fa-atom"></i><div class="tooltip">ML SCAN</div></div>        
    <div class="dock-btn" onclick="openWindow('win-game')" style="color:var(--neon-red); border-color:var(--neon-red);">        
        <i class="fas fa-gamepad"></i>        
        <div class="tooltip">DEFENSE GAME</div>    
    </div>
    
    <div class="dock-btn" onclick="openWindow('win-ftc-scout')" style="color:var(--neon-pink); border-color:var(--neon-pink);">
        <i class="fas fa-robot"></i>
        <div class="tooltip">FTC DASHBOARD</div>
    </div>
    
    <div class="dock-btn" onclick="openWindow('win-docs')"><i class="fas fa-book"></i><div class="tooltip">DATA</div></div>    
    <div class="dock-btn" onclick="openWindow('win-gallery')"><i class="fas fa-satellite"></i><div class="tooltip">GALLERY</div></div>
</div>

<button id="meteor-chat-btn" onclick="toggleChat()"><i class="fas fa-comment"></i></button>

<div id="win-nasa" class="window" style="width: 900px; height: 600px; top: 80px; left: 120px;">    <div class="win-header"><div class="win-title">/// VISOR_TELESCOPIO.EXE</div><button class="win-close" onclick="closeWindow('win-nasa')">‚úï</button></div>    <div class="win-body" style="padding:0; background:#000;"><iframe src="https://eyes.nasa.gov/apps/exo/" style="width:100%; height:100%; border:none;"></iframe></div></div>
<div id="win-analysis" class="window" style="display:flex; width: 750px; height: 680px; top: 100px; left: 150px;">    <div class="win-header"><div class="win-title">/// CLASIFICADOR_RF_IA.EXE</div><button class="win-close" onclick="closeWindow('win-analysis')">‚úï</button></div>    <div class="win-body">        <div id="hologram-container">            <div id="planet-viz"></div>            <div id="planet-name-label">NO TARGET</div>        </div>        <div style="margin-bottom: 20px;">            <span class="input-label" id="lbl-name">NOMBRE DE MISI√ìN / PLANETA</span>            <div style="display:flex; gap:10px;">                <input type="text" class="input-tech" id="planet_name" placeholder="Kepler-X..." oninput="updateHologram()">                <button onclick="setRandomName()" style="background:#333; border:1px solid var(--neon-gold); color:#fff; cursor:pointer; border-radius:5px; padding:0 15px;">üé≤</button>            </div>        </div>        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">            <div><span class="input-label" id="lbl-rad">RADIO (R‚äï)</span><input type="number" id="koi_prad" class="input-tech" placeholder="1.2" value="1.2" oninput="updateHologram()"></div>            <div><span class="input-label" id="lbl-srad">RADIO ESTRELLA (R‚òâ)</span><input type="number" id="koi_srad" class="input-tech" placeholder="1.0" value="1.0"></div>            <div><span class="input-label" id="lbl-per">PERIODO (D√çAS)</span><input type="number" id="koi_period" class="input-tech" placeholder="365" value="365"></div>            <div><span class="input-label" id="lbl-temp">TEMP (K)</span><input type="number" id="koi_steff" class="input-tech" placeholder="288" value="288" oninput="updateHologram()"></div>        </div>        <button id="btn-analyze" onclick="runAnalysis()" style="width:100%; padding:15px; background:linear-gradient(90deg, var(--neon-blue), var(--neon-green)); border:none; font-weight:bold; cursor:pointer; border-radius:5px; color:#000; font-family:var(--font-title); letter-spacing:1px;">INICIAR AN√ÅLISIS</button>        <div id="ml-result" style="margin-top:20px; padding:15px; background:rgba(0,0,0,0.3); border-radius:5px; display:none;"></div>        <div id="deep-report-container" style="margin-top:10px;"></div>    </div></div>
<div id="win-game" class="window" style="width: 500px; height: 550px; top: 100px; left: 300px; border-color: var(--neon-red);">    <div class="win-header" style="background: rgba(255,0,0,0.1);"><div class="win-title" style="color:var(--neon-red);">/// DEFENSA_ORBITAL_v2</div><button class="win-close" onclick="closeWindow('win-game')">‚úï</button></div>    <div class="win-body" style="position:relative; padding:0; overflow:hidden;">        <div id="game-overlay">            <h2 style="color:var(--neon-red);" id="game-title">ALERTA DE IMPACTO</h2>            <p style="color:#ddd; font-size:14px; max-width:80%; line-height:1.6;" id="game-desc">                ¬°Capit√°n! Asteroides detectados.<br>Presiona 'A' para PILOTO AUTOM√ÅTICO (IA).            </p>            <button class="game-btn" onclick="startGame()" id="btn-start">DESPLEGAR CAZAS</button>        </div>        <div style="position:absolute; top:10px; left:10px; font-family:monospace; color:var(--neon-gold); pointer-events:none;">SCORE: <span id="game-score">0</span></div>        <div id="ai-status">ü§ñ IA AUTOPILOT: ON</div>        <canvas id="game-canvas"></canvas>    </div></div>
<div id="win-docs" class="window" style="width: 800px; height: 600px; top: 120px; left: 150px;">    <div class="win-header"><div class="win-title">/// ARCHIVOS_SISTEMA.DAT</div><button class="win-close" onclick="closeWindow('win-docs')">‚úï</button></div>    <div class="win-body doc-content">        <h1 style="color:var(--neon-blue);">Proyecto Aztl√°n: AI Integration</h1>        <p><strong>Estado:</strong> Clasificado | <strong>Versi√≥n:</strong> 6.5 AI</p>    </div></div>
<div id="win-gallery" class="window" style="width: 600px; height: 500px; top: 140px; left: 200px;">    <div class="win-header"><div class="win-title">/// FEED_NASA</div><button class="win-close" onclick="closeWindow('win-gallery')">‚úï</button></div>    <div class="win-body">        <div style="display:flex; gap:10px; margin-bottom:15px;"><input id="nasa-q" placeholder="Nebula..." style="flex:1; background:#222; border:none; color:#fff; padding:8px;"><button onclick="loadNasa()" style="background:var(--neon-blue); border:none; padding:0 15px; font-weight:bold; cursor:pointer;">GO</button></div>        <div id="nasa-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(120px, 1fr)); gap:10px;"></div>    </div></div>
<div id="win-chat" class="window" style="width: 350px; height: 500px; bottom: 120px; right: 30px; top: auto; left: auto; border-color: var(--neon-gold);">    <div class="win-header" style="background: rgba(255, 170, 0, 0.1);">        <div class="win-title" style="color: var(--neon-gold);">OR√ÅCULO AZTL√ÅN</div>        <button class="win-close" onclick="toggleChat()">‚úï</button></div>    <div class="win-body" style="display:flex; flex-direction:column;">        <div id="chat-history" style="flex:1; overflow-y:auto; display:flex; flex-direction:column;"><div class="msg ai">A la orden, Capit√°n.</div></div>        <form onsubmit="event.preventDefault(); sendChat();" style="display:flex; margin-top:10px; border-top:1px solid #333; padding-top:10px;">            <input id="chat-input" placeholder="..." style="flex:1; background:transparent; border:none; color:#fff; outline:none;">            <button type="submit" style="background:none; border:none; color:var(--neon-gold); cursor:pointer;">‚û§</button>        </form></div></div>

<div id="win-ftc-scout" class="window" style="width: 1100px; height: 750px; top: 80px; left: 100px;">
    <div class="win-header">
        <div class="win-title" style="color:var(--neon-pink);">/// FTC_SCOUT_TERMINAL.EXE</div>
        <button class="win-close" onclick="closeWindow('win-ftc-scout')">‚úï</button>
    </div>
    <div class="win-body" style="padding: 10px 20px;">
        
        <div style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
            <span class="input-label" style="margin-bottom:0; color:var(--neon-pink);">C√ìDIGO DE EVENTO:</span>
            <input type="text" class="input-tech" id="eventCodeInput" placeholder="Ej: MXSTQ (Guadalajara)" value="MXSTQ" style="width: 150px;">
            <span class="input-label" style="margin-bottom:0;">UMBRAL DE AVANCE RP:</span>
            <input type="number" class="input-tech" id="rpUmbralInput" value="54" style="width: 100px;">
            
            <button onclick="cargarDashboard()" style="background:var(--neon-pink); border:none; padding:10px 20px; font-weight:bold; cursor:pointer; border-radius:5px; color:#000; font-family:var(--font-title); letter-spacing:1px;">
                <i class="fas fa-sync"></i> OBTENER RANKINGS
            </button>
            
            <button onclick="document.getElementById('rpUmbralInput').value = '54'; cargarDashboard();" 
                    style="background:rgba(255,255,0,0.2); border:1px solid var(--neon-gold); padding:10px 10px; font-weight:bold; cursor:pointer; border-radius:5px; color:var(--neon-gold); font-family:var(--font-title); font-size: 12px;">
                <i class="fas fa-undo"></i> RESETEAR UMBRAL
            </button>
            <div id="api-status" style="margin-left:auto; color:var(--neon-green); font-size:12px;">STATUS: OFFLINE</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>N√∫m. Equipo</th>
                    <th>Nombre</th>
                    <th>W / L / T</th>
                    <th>RP Total</th>
                    <th>Umbral (Meta)</th>
                    <th>PASE NACIONAL</th>
                    <th>Detalle</th>
                </tr>
            </thead>
            <tbody id="listaEquiposScout">
                <tr><td colspan="8" style="text-align:center; color:#888;">Carga un c√≥digo de evento para iniciar (Ej: MXSTQ).</td></tr>
            </tbody>
        </table>
        
        <div id="fichaDetalleScout" class="detalle-ficha" style="margin-top: 20px; border-color:var(--neon-pink);">
            </div>
    </div>
</div>
<script>
// --- GLOBAL STATE ---
let userLevel=1, userXP=0, currentLang='es';
const translations={es:{title:"PROYECTO AZTL√ÅN",lblName:"NOMBRE DE MISI√ìN / PLANETA",lblRad:"RADIO (R‚äï)",lblSRad:"RADIO ESTRELLA (R‚òâ)",lblPer:"PERIODO (D√çAS)",lblTemp:"TEMP (K)",btnAnalyze:"INICIAR AN√ÅLISIS",gameTitle:"ALERTA DE IMPACTO",gameDesc:"¬°Capit√°n! Asteroides detectados.<br>Presiona 'A' para PILOTO AUTOM√ÅTICO (IA).",btnStart:"DESPLEGAR CAZAS"},en:{title:"PROJECT AZTLAN",lblName:"MISSION / PLANET NAME",lblRad:"RADIUS (R‚äï)",lblSRad:"STAR RADIUS (R‚òâ)",lblPer:"PERIOD (DAYS)",lblTemp:"TEMP (K)",btnAnalyze:"START ML ANALYSIS",gameTitle:"IMPACT WARNING",gameDesc:"Captain! Asteroids detected.<br>Press 'A' for AI AUTO-PILOT.",btnStart:"DEPLOY FIGHTERS"}};

window.onload=()=>{
    // ... C√≥digo de carga y animaci√≥n ...
    if(localStorage.getItem('aztlan_lvl')){userLevel=parseInt(localStorage.getItem('aztlan_lvl'));userXP=parseInt(localStorage.getItem('aztlan_xp'));updateBadge();}
    const t=["LOADING...","SYSTEM ONLINE"];let i=0;const inv=setInterval(()=>{document.getElementById('boot-text').innerText=t[i];i++;if(i>=t.length){clearInterval(inv);setTimeout(()=>{document.getElementById('boot-screen').style.opacity='0';setTimeout(()=>document.getElementById('boot-screen').style.display='none',1000);},800);}},800);
    init3D();
    updateHologram();
};

function toggleLang(){/* ... */};
function updateBadge(){/* ... */};
function addXP(a){/* ... */};
function setRandomName(){/* ... */};
function updateHologram(){/* ... */};
async function runAnalysis(){/* ... */};
async function runDeepScan(p){/* ... */};
let gameInt,cvs=document.getElementById('game-canvas'),ctx=cvs.getContext('2d'),ship={x:0},bullets=[],enemies=[],particles=[],score=0,active=false,autoPilot=false;
cvs.onmousemove=e=>{if(!autoPilot)ship.x=e.clientX-cvs.getBoundingClientRect().left;};
cvs.onmousedown=()=>{if(active&&!autoPilot)bullets.push({x:ship.x,y:cvs.height-40});};
document.addEventListener('keydown',e=>{if(e.key.toLowerCase()==='a'&&active){autoPilot=!autoPilot;document.getElementById('ai-status').style.display=autoPilot?'block':'none';}});
function startGame(){/* ... */};
function updateGame(){/* ... */};
async function gameOver(){/* ... */};
function toggleChat(){const w=document.getElementById('win-chat');w.style.display=w.style.display==='flex'?'none':'flex';}
function openWindow(id){document.querySelectorAll('.window').forEach(w=>w.style.zIndex=10);const w=document.getElementById(id);w.style.display='flex';w.style.zIndex=20;}
function closeWindow(id){document.getElementById(id).style.display='none';}
async function sendChat(){/* ... */};
async function loadNasa(){/* ... */};
function init3D(){/* ... */};
document.querySelectorAll('.win-header').forEach(h=>{h.onmousedown=e=>{if(window.innerWidth<768)return;const w=h.parentElement;let ox=e.clientX-w.offsetLeft,oy=e.clientY-w.offsetTop;document.onmousemove=ev=>{w.style.left=(ev.clientX-ox)+'px';w.style.top=(ev.clientY-oy)+'px';};document.onmouseup=()=>{document.onmousemove=null;};};});


// =========================================================================
// === C√ìDIGO FTC SCOUTING (INTEGRACI√ìN API) ================================
// =========================================================================

// TUS CREDENCIALES DE LA API DE FTC
const USERNAME = 'tennyson';
const AUTH_TOKEN = '5EB69BCF-B53C-4B69-8874-CBF204FAD462';
const BASE_URL = 'https://ftc-events.firstinspires.org';
const AUTH_STRING = btoa(USERNAME + ':' + AUTH_TOKEN); 

// --- FUNCIONES DE LA API ---

// 1. Obtener Rankings (RP, W/L/T)
async function fetchRankings(eventCode) {
    document.getElementById('api-status').innerText = 'STATUS: CARGANDO RANKINGS...';
    const endpoint = `/api/v2/event/${eventCode}/rankings`;
    const url = BASE_URL + endpoint;

    try {
        const respuesta = await fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Authorization': `Basic ${AUTH_STRING}` 
            }
        });

        if (!respuesta.ok) {
            document.getElementById('api-status').innerText = `ERROR: ${respuesta.status}. C√≥digo no v√°lido.`;
            throw new Error(`Error HTTP: ${respuesta.status}`);
        }

        document.getElementById('api-status').innerText = 'STATUS: DATOS DE RANKING OBTENIDOS.';
        const datos = await respuesta.json();
        return datos.rankings || [];
        
    } catch (error) {
        console.error("No se pudo obtener la informaci√≥n de Rankings:", error);
        document.getElementById('api-status').innerText = 'STATUS: ERROR DE CONEXI√ìN.';
        return [];
    }
}

// 2. Obtener Premios (Para calcular RP de bonificaci√≥n)
async function fetchAwards(eventCode) {
    const endpoint = `/api/v2/event/${eventCode}/awards`;
    const url = BASE_URL + endpoint;
    
    try {
        const respuesta = await fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Authorization': `Basic ${AUTH_STRING}` 
            }
        });
        
        if (!respuesta.ok) return [];
        const datos = await respuesta.json();
        return datos.awards || [];
        
    } catch (error) {
        console.error("No se pudo obtener la informaci√≥n de Premios:", error);
        return [];
    }
}

// --- FUNCI√ìN PRINCIPAL DEL DASHBOARD ---

async function cargarDashboard() {
    const eventCode = document.getElementById('eventCodeInput').value.toUpperCase();
    const umbralRP = parseInt(document.getElementById('rpUmbralInput').value);
    const listaEquipos = document.getElementById('listaEquiposScout');
    
    // Ocultar ficha de detalle al cargar nuevos datos
    document.getElementById('fichaDetalleScout').style.display = 'none'; 
    
    if (!eventCode || isNaN(umbralRP)) {
        listaEquipos.innerHTML = '<tr><td colspan="8" style="text-align:center; color:var(--neon-red);">Ingrese un c√≥digo de evento y un umbral de RP v√°lido.</td></tr>';
        return;
    }

    listaEquipos.innerHTML = '<tr><td colspan="8" style="text-align:center; color:var(--neon-blue);">BUSCANDO DATOS...</td></tr>';
    
    // 1. Obtener Rankings y Premios de la API
    const datosRanking = await fetchRankings(eventCode);
    const datosPremios = await fetchAwards(eventCode);
    
    listaEquipos.innerHTML = ''; // Limpiar la tabla

    if (datosRanking.length === 0) {
        listaEquipos.innerHTML = '<tr><td colspan="8" style="text-align:center; color:var(--neon-red);">No se encontraron equipos o el c√≥digo de evento es incorrecto.</td></tr>';
        return;
    }

    // 2. Procesar y Mostrar Datos
    datosRanking.forEach(equipo => {
        const rpTotal = equipo.rankingPoints || 0;
        const numEquipo = equipo.team.teamNumber;
        const rank = equipo.rank || 'N/A';
        const wins = equipo.wins || 0;
        const losses = equipo.losses || 0;
        const ties = equipo.ties || 0;

        // L√≥gica de Clasificaci√≥n
        const clasificado = rpTotal >= umbralRP; 
        const estatusPase = clasificado ? 'S√ç CLASIFICADO' : 'NO (Falta Clasificar)';
        const clasePase = clasificado ? 'pase-si' : 'pase-no';
        const rpFaltante = rpTotal < umbralRP ? umbralRP - rpTotal : 0;
        
        // Determinar premios relevantes para el detalle (buscar en datosPremios)
        const premiosEquipo = datosPremios.filter(award => 
            award.teamIds.includes(numEquipo)
        ).map(award => award.name);
        
        
        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td>${rank}</td>
            <td>${numEquipo}</td>
            <td>${equipo.team.name}</td>
            <td>${wins} / ${losses} / ${ties}</td>
            <td style="font-weight:bold;">${rpTotal}</td>
            <td>${umbralRP}</td>
            <td class="${clasePase}">${estatusPase}</td>
            <td>
                <button class="toggle-btn" 
                    onclick="mostrarDetalleScout(
                        ${numEquipo}, 
                        '${equipo.team.name}', 
                        ${rpTotal}, 
                        ${umbralRP}, 
                        ${rpFaltante}, 
                        '${wins} / ${losses} / ${ties}', 
                        '${premiosEquipo.join('; ')}' 
                    )">Ver Ficha ‚û°Ô∏è
                </button>
            </td>
        `;
        listaEquipos.appendChild(fila);
    });
}

// --- FUNCI√ìN DE DETALLE (FICHA COMPLETA) ---
function mostrarDetalleScout(num, nombre, rpTotal, umbral, rpFaltante, wlt, premios) {
    const fichaDetalle = document.getElementById('fichaDetalleScout');
    
    const wins = parseInt(wlt.split('/')[0]);
    const ties = parseInt(wlt.split('/')[2]);
    const rpMatches = (wins * 8) + (ties * 4); // C√°lculo de RP por Match Win/Tie
    const rpBonificacion = rpTotal - rpMatches; // RP restante asumido por premios/alianzas
    const clasificado = rpTotal >= umbral; 
    const paseClass = clasificado ? 'pase-si' : 'pase-no';
    
    // Lista de premios formateada
    const listaPremios = premios.split('; ').filter(p => p !== '').map(p => {
        let rpValue = '?? RP';
        if (p.includes('Inspire')) rpValue = '+15 RP';
        else if (p.includes('Award') || p.includes('Alliance')) rpValue = '+10 RP'; // Generalizaci√≥n
        return `<li>${p} (<span style="color:var(--neon-green);">${rpValue}</span>)</li>`;
    }).join('');


    fichaDetalle.innerHTML = `
        <h3>Ficha de Scouting Profundo: ${nombre} (${num})</h3>
        
        <div style="display: flex; gap: 40px;">
            <div>
                <h4>ESTATUS DE CLASIFICACI√ìN RP</h4>
                <p class="${paseClass}" style="font-size: 1.2em;">
                    ${clasificado ? '¬°YA CLASIFIC√ì! ‚úÖ' : `NECESITA <span class='rp-destacado'>${rpFaltante} RP</span> M√ÅS`}
                </p>
                <p>Umbral de Avance Regional (Meta): <span class='rp-destacado'>${umbral} RP</span></p>
                <p>Puntos Acumulados (Total RP): <span class='rp-destacado'>${rpTotal}</span></p>
                
                <h4>RP FALTANTE (POTENCIAL DE AVANCE)</h4>
                <p>Para obtener **${rpFaltante} RP**, el equipo puede:</p>
                <ul>
                    <li>Ganar el **Inspire Award** (+15 RP)</li>
                    <li>Ser **Winning Alliance Captain** (+10 RP)</li>
                    <li>Ganar **${Math.ceil(rpFaltante / 8)} Matches** (si solo conf√≠a en victorias)</li>
                </ul>
            </div>

            <div>
                <h4>DESEMPE√ëO CUANTITATIVO</h4>
                <p>R√©cord (W/L/T): <strong>${wlt}</strong></p>
                <p>RP por Matches (Pista): <strong>${rpMatches} RP</strong></p>
                <p>RP por Bonificaci√≥n (Premios/Alianzas): <strong>${rpBonificacion} RP</strong> (Puntos por dise√±o, *outreach*, etc.)</p>
                
                <h4 style="margin-top:15px;">PREMIOS DE AVANCE OBTENIDOS</h4>
                ${premios.length === 0 ? '<p style="color:#aaa;">Ning√∫n premio de avance registrado en la API.</p>' : `<ul>${listaPremios}</ul>`}
                
                <h4 style="margin-top:15px;">SCOUTING CUALITATIVO</h4>
                <p style="color:var(--neon-gold);">[Aqu√≠ puedes a√±adir tus notas de *scouting* manual]</p>
            </div>
        </div>
    `;
    fichaDetalle.style.display = 'block';
    window.scrollTo(0, 0); // Vuelve al inicio de la ventana para ver la ficha
}


// Llamar a cargarDashboard() cuando se inicia el sistema (despu√©s de la animaci√≥n de boot)
setTimeout(() => {
    // Si quieres que cargue el regional Guadalajara por defecto al inicio:
    // cargarDashboard(); 
}, 1500); // 1.5 segundos despu√©s de que la pantalla de inicio desaparece

</script>
</body>
</html>
